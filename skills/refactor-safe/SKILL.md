# Skill: refactor-safe（安全なリファクタ）

## 目的

振る舞いを変えずに構造を改善し、将来変更のコストとリスクを下げる。

## 入力（必須）

- 対象範囲（モジュール/ディレクトリ/コンポーネント）
- 変更理由（保守性、複雑性、重複、性能、セキュリティ等）
- 受入基準（振る舞い不変、性能劣化なし等）
- 変更禁止領域（API、外部I/F、生成物など）

## 出力（成果物）

- 小さく分割されたリファクタ PR（レビュー容易な差分）
- 検証結果（既存テスト PASS、必要なら計測結果）
- 影響範囲とロールバック手順

## 手順

1. 変更単位を小さく切る
   - 1 PR = 1 意図（命名変更、責務分割、重複排除など）にする
2. セーフガードを先に置く
   - 既存テストを実行し、必要なら先にテストを追加してから着手
3. 振る舞いを変えない変更を優先する
   - 外部I/F は維持し、内部構造のみ変更する
4. 差分の可読性を優先する
   - 不要なフォーマット変更/一括置換は避ける
5. 検証して証跡を残す

## チェック（品質ゲート）

- [ ] 受入基準（振る舞い不変）を満たす
- [ ] テストが PASS する
- [ ] レビュー可能な差分サイズ（分割されている）

## 失敗時の対応

- 影響が大きい: さらに分割し、段階的に適用する
- 挙動差分が出た: 仕様変更か不具合かを切り分け、Issue に決定を残す

