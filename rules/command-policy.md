# 実行境界（Rules）ポリシー雛形

## 目的

エージェントのコマンド実行・変更範囲を「運用ルール」として固定し、事故（Secrets 漏えい、破壊的操作、権限逸脱）を抑止する。

## 用語

- allow: 事前承認なしで実行してよい
- prompt: 人間承認が必要（理由/影響/証跡を残す）
- forbidden: 禁止（代替案を提示し、実行しない）

## ポリシー（例）

### allow（例）

- 読み取り/調査: `git status`, `git diff`, `rg`, `ls`, `cat`
- 品質ゲート: `npm test`, `npm run lint`, `npm run build`, `pytest`
- 破壊的でないビルド/検証（成果物のみ生成し、公開はしない）

### prompt（例）

- 依存更新: `npm install`, `npm audit fix`, `pip-compile` など
- 環境変更: ツールチェーン更新、設定の大幅変更
- 破壊的操作の可能性: `git rebase`, `git reset`, 大量削除を伴う変更
- Secrets を利用する操作（デプロイ、外部API呼び出し等）

### forbidden（例）

- Secrets の出力/外部送信（Issue/PR/ログへの貼り付けを含む）
- 認可されていない破壊的操作: `rm -rf /`, `git push --force`（明示承認なし）
- 監査性を損なう操作（ログ無効化、証跡削除の隠蔽）

## 承認フロー（prompt の運用）

1. エージェントは「目的/変更内容/影響/ロールバック/実行コマンド」を提示
2. 人間が承認/却下（判断理由を Issue/PR に残す）
3. 実行後、証跡（コマンドと結果、差分、ロールバック）を PR に残す

## 例外対応（最小）

- 緊急対応で prompt を省略する場合は、事後に必ず「理由/影響/証跡」を記録する
- 例外は恒久化せず、ルール更新（allow/prompt の見直し）で再発防止を図る

## 監査（推奨）

- コマンド実行: 実行内容と結果（要約可）
- 権限/Secrets: 利用の有無と目的（値は残さない）
- 意思決定: Issue コメントで仕様差分として残す

