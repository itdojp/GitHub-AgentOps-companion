# MCP 公開範囲設計例（概念テンプレ）

## 目的

MCP（ツール公開）を「公開最小化」「Secrets 境界」「監査可能性」の観点で設計し、エージェント運用の事故（権限逸脱/Secrets 漏えい）を抑止する。

## 設計観点

### 1) 公開するツール（最小化）

- 読み取り系: リポジトリ参照、Issue/PR 参照、ログ参照（必要最小）
- 書き込み系: PR 作成/更新、コメント（承認フローに連動）
- 実行系: `lint/test/build` 等（allow リスト運用）

### 2) Secrets 境界

- 取得不可: Secrets の値、トークン全文、個人情報
- 承認必須: Secrets を使う操作（デプロイ、外部API呼び出し等）
- ログ: 参照/利用のメタ情報（誰が/いつ/何に使ったか）を残す

### 3) 監査（何を残すか）

- 仕様差分: Issue/PR コメントで意思決定を残す
- 実行ログ: コマンド/結果（要約でも可）
- 例外承認: 誰が、何を、なぜ承認したか

## 例: 役割別の公開範囲

| Agent | allow（例） | prompt（例） | forbidden（例） |
|---|---|---|---|
| doc-agent | lint/build/link-check | 生成物の大規模変更 | Secrets 出力 |
| test-agent | test 実行、テスト追加 | 新規依存導入 | Secrets 出力 |
| dep-agent | 依存更新 + CI | major 更新、環境変更 | Secrets 出力 |

## 例外時の承認フロー（最小）

1. エージェントが「prompt 対象」の理由と影響を提示
2. 人間が承認/却下（ログを残す）
3. 実行後に証跡（コマンド/結果/ロールバック）を PR に残す

